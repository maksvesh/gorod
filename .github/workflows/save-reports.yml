name: Save Game Results

on:
  repository_dispatch:
    types: [save_game_result]

jobs:
  save-result:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITO }}
          
      - name: Create results directory
        run: mkdir -p game-results
        
      - name: Save game result
        env:
          GAME_DATA: ${{ toJson(github.event.client_payload.game_data) }}
          PLAYER_NAME: ${{ github.event.client_payload.player_name }}
        run: |
          TIMESTAMP=$(date +%Y%m%d_%H%M%S)
          # –û—á–∏—â–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –æ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
          CLEAN_NAME=$(echo "$PLAYER_NAME" | tr -cd 'a-zA-Z0-9_-')
          FILENAME="game_result_${TIMESTAMP}_${CLEAN_NAME}.json"
          echo "$GAME_DATA" > "game-results/$FILENAME"
          echo "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: $FILENAME"
          
      - name: Commit and push
        run: |
          git config --local user.email "maksvesh@yandex.ru"
          git config --local user.name "Save Game Results"
          git add game-results/
          git commit -m "üéÆ –ù–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã: ${{ github.event.client_payload.player_name }}"
          git push
