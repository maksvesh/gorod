name: Save Game Reports

on:
  workflow_dispatch:  # –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
  repository_dispatch:  # –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ API
    types: [game-report]

jobs:
  save-report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Save game report
        env:
          GITHUB_TOKEN: ${{ secrets.GAME_REPORTS_TOKEN }}
        run: |
          # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
          mkdir -p reports
          
          # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
          TIMESTAMP=$(date +%Y%m%d_%H%M%S)
          FILENAME="reports/game_report_${TIMESTAMP}.json"
          
          # –°–æ–∑–¥–∞–µ–º JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Å–æ–±—ã—Ç–∏—è
          echo '${{ toJson(github.event.client_payload) }}' > $FILENAME
          
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # –ö–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º
          git add $FILENAME
          git commit -m "üéÆ Game report: $TIMESTAMP"
          git push
