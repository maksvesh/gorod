name: Save Game Results

on:
  workflow_dispatch:    # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  repository_dispatch:  # –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ API (–≤–∞—à–∞ –∫–Ω–æ–ø–∫–∞)
    types: [game_results]

jobs:
  save-results:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITO }}
        
    - name: Create results directory
      run: mkdir -p game-results
        
    - name: Process game results
      env:
        GAME_DATA: ${{ toJson(github.event.client_payload.game_data) }}
        PLAYER_NAME: ${{ github.event.client_payload.player_name }}
      run: |
        if [ -n "$GAME_DATA" ]; then
          TIMESTAMP=$(date +%Y%m%d_%H%M%S)
          FILENAME="result_${TIMESTAMP}_${PLAYER_NAME}.json"
          echo "$GAME_DATA" > "game-results/$FILENAME"
          echo "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: $FILENAME"
        else
          echo "‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"
          exit 1
        fi
        
    - name: Commit and push results
      run: |
        git config --local user.email "maksvesh@yandex.ru"
        git config --local user.name "GITO"
        git add game-results/
        git commit -m "üéÆ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã: ${{ github.event.client_payload.player_name }}"
        git push
